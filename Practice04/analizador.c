#include <stdio.h>

//Funciones
void errorP();
void capaLLC();
void analiza(unsigned char T[]);
void checkSUM(unsigned char T[],unsigned short int iniT,unsigned short int finT,unsigned short int posXN, int chFlag);
void commonPort(unsigned short int portA);
unsigned char noBits(unsigned char T[]);

//Variables
int i,verCS;
unsigned char TamIP,TamTCP;
char supervision[][5]={"RR","RNR","REJ","SREJ"};
char UC[][6]={"UI","SIM","","SARM","UP","","","SABM","DISC","","","SARME","","","","SABME","SNRM","","","RSET","","","","XID","","","","SNRME","","","","SNRM"};
char UR[][5]={"UI","RIM","","DM","","","","","RD","","","","UA","TEST","","","","","FRMR","","","","","","XID","","","","","TEST","","",""};
char TDH[][12]={"-","Ethernet","-","-","Token Ring","-","IEE","","","","","","","","","Frame Relay","ATM"};
char TDP[][4]={"","","","","","","","","IP",""};
char OPC[][10]={"SolARP","RespARP","SolInvARP","RespInvARP"};
char POF[][2]={"P","F"};

unsigned char T[ ][200]={
{0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x03, 0xf0, 0xf0,
0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x43, 0x05, 0x90, 0x6d},//Trama 1

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x03, 0xf0, 0xf1,
0x73, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x54, 0x90, 0x6d},//Trama 2

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x04, 0xf0, 0xf1,
0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf2, 0x90, 0x6d},//Trama 3

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x04, 0xf0, 0xf1,
0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf2, 0x90, 0x6d},//Trama4

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x12, 0xf0, 0xf0,
0x00, 0x01, 0x0e, 0x00, 0xff, 0xef, 0x17, 0x81, 0xbc, 0x05, 0x23, 0x00, 0x7f, 0x00, 0x23, 0x7f,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x90, 0x91, 0x6d},//Trama 5

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x12, 0xf0, 0xf0,
0x00, 0x03, 0x0e, 0x00, 0xff, 0xef, 0x17, 0x81, 0xbc, 0x05, 0x23, 0x00, 0x7f, 0x00, 0x23, 0x7f,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x90, 0x91, 0x6d},//Trama 6

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x04, 0xf0, 0xf1,
0x01, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xdf, 0x91, 0x6d},//Trama 7

{0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x04, 0xf0, 0xf1,
0x01, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0xac, 0x92, 0x6d},//Trama 8

{0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0xac, 0xf0, 0xf0,
0x02, 0x02, 0x0e, 0x00, 0xff, 0xef, 0x16, 0x04, 0x00, 0x00, 0x00, 0x00, 0x28, 0x00, 0x7f, 0x23,
0xff, 0x53, 0x4d, 0x42, 0x72, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x82, 0x09,
0x00, 0x77, 0x00, 0x02, 0x50, 0x43, 0x20, 0x4e, 0x45, 0x54, 0x57, 0x4f, 0x52, 0x4b, 0x20, 0x50,
0x52, 0x4f, 0x47, 0x52, 0x41, 0x4d, 0x20, 0x31, 0x2e, 0x30, 0x00, 0x02, 0x4d, 0x49, 0x43, 0x52,
0x4f, 0x53, 0x4f, 0x46, 0x54, 0x20, 0x4e, 0x45, 0x54, 0x57, 0x4f, 0x52, 0x4b, 0x53, 0x20, 0x33,
0x2e, 0x30, 0x00, 0x02, 0x44, 0x4f, 0x53, 0x20, 0x4c, 0x4d, 0x31, 0x2e, 0x32, 0x58, 0x30, 0x30,
0x32, 0x00, 0x02, 0x44, 0x4f, 0x53, 0x20, 0x4c, 0x41, 0x4e, 0x4d, 0x41, 0x4e, 0x32, 0x2e, 0x31,
0x00, 0x02, 0x57, 0x69, 0x6e, 0x64, 0x6f, 0x77, 0x73, 0x20, 0x66, 0x6f, 0x72, 0x20, 0x57, 0x6f,
0x72, 0x6b, 0x67, 0x72, 0x6f, 0x75, 0x70, 0x73, 0x20, 0x33, 0x2e, 0x31, 0x61, 0x00, 0x02, 0x4e,
0x54, 0x20, 0x4c, 0x4d, 0x20, 0x30, 0x2e, 0x31, 0x32, 0x00, 0x00, 0xfb, 0x92, 0x6d, 0x86, 0xdf},//Trama 9

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x04, 0xf0, 0xf1,
0x01, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7b, 0x93, 0x6d},//Trama 10

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x5f, 0xf0, 0xf0,
0x02, 0x04, 0x0e, 0x00, 0xff, 0xef, 0x16, 0x0c, 0x00, 0x00, 0x28, 0x00, 0x28, 0x00, 0x23, 0x7f,
0xff, 0x53, 0x4d, 0x42, 0x72, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x82, 0x09,
0x11, 0x05, 0x00, 0x02, 0x02, 0x00, 0x01, 0x00, 0x68, 0x0b, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00,
0x7f, 0x07, 0x00, 0x80, 0x03, 0x02, 0x00, 0x00, 0x00, 0xe5, 0xfe, 0x29, 0x25, 0x7c, 0xc2, 0x01,
0x2c, 0x01, 0x08, 0x08, 0x00, 0x7f, 0x07, 0x00, 0x80, 0x32, 0x3e, 0xb9, 0x3d, 0x00, 0xca, 0x93},//Trama 11

{0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x04, 0xf0, 0xf1,
0x01, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x94, 0x6d},//Trama 12

{0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x91, 0xf0, 0xf0,
0x04, 0x04, 0x0e, 0x00, 0xff, 0xef, 0x16, 0x0c, 0x00, 0x00, 0x28, 0x00, 0x28, 0x00, 0x7f, 0x23,
0xff, 0x53, 0x4d, 0x42, 0x73, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x82, 0x09,
0x0d, 0x75, 0x00, 0x5d, 0x00, 0x68, 0x0b, 0x02, 0x00, 0x00, 0x00, 0x7f, 0x07, 0x00, 0x80, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x45,
0x53, 0x43, 0x4f, 0x4d, 0x00, 0x57, 0x69, 0x6e, 0x64, 0x6f, 0x77, 0x73, 0x20, 0x34, 0x2e, 0x30,
0x00, 0x57, 0x69, 0x6e, 0x64, 0x6f, 0x77, 0x73, 0x20, 0x34, 0x2e, 0x30, 0x00, 0x04, 0xff, 0x00,
0x00, 0x00, 0x02, 0x00, 0x02, 0x00, 0x17, 0x00, 0x20, 0x00, 0x5c, 0x5c, 0x50, 0x52, 0x4f, 0x47,
0x59, 0x44, 0x45, 0x53, 0x41, 0x5c, 0x49, 0x50, 0x43, 0x24, 0x00, 0x49, 0x50, 0x43, 0x00, 0x00},//Trama 13

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x04, 0xf0, 0xf1,
0x01, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x32, 0x95, 0x6d},//Trama 14

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x46, 0xf0, 0xf0,
0x04, 0x06, 0x0e, 0x00, 0xff, 0xef, 0x16, 0x0c, 0x00, 0x00, 0x28, 0x00, 0x28, 0x00, 0x23, 0x7f,
0xff, 0x53, 0x4d, 0x42, 0x73, 0x00, 0x00, 0x00, 0x00, 0x90, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x82, 0x09,
0x03, 0x75, 0x00, 0x29, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0xff, 0x00, 0x00, 0x00, 0x04, 0x00,
0x49 , 0x50, 0x43, 0x00, 0x00, 0x81, 0x95, 0x6d, 0x86, 0xcb, 0x94, 0x6d, 0x86, 0x0d, 0x09, 0x0e},//Trama 15

{0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x04, 0xf0, 0xf1,
0x01, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x96, 0x6d},//Trama16

{0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x7e, 0xf0, 0xf0,
0x06, 0x06, 0x0e, 0x00, 0xff, 0xef, 0x16, 0x0c, 0x00, 0x00, 0x28, 0x00, 0x28, 0x00, 0x7f, 0x23,
0xff, 0x53, 0x4d, 0x42, 0x25, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x82, 0x0a,
0x0e, 0x20, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x88, 0x13, 0x00,
0x00, 0x00, 0x00, 0x20, 0x00, 0x4c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2d, 0x00, 0x5c,
0x50, 0x49, 0x50, 0x45, 0x5c, 0x4c, 0x41, 0x4e, 0x4d, 0x41, 0x4e, 0x00, 0x68, 0x00, 0x57, 0x72,
0x4c, 0x65, 0x68, 0x44, 0x7a, 0x00, 0x42, 0x31, 0x36, 0x42, 0x42, 0x44, 0x7a, 0x00, 0x01, 0x00,
0x00, 0x10, 0xff, 0xff, 0xff, 0xff, 0x45, 0x53, 0x43, 0x4f, 0x4d, 0x00, 0x00, 0x6f, 0x96, 0x6d},//Trama17

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x04, 0xf0, 0xf1,
0x01, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xbe, 0x96, 0x6d},//Trama18

{0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x04, 0xf0, 0xf1,
0x01, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x5d, 0x97, 0x6d},//Trama19

{0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x7e, 0xf0, 0xf0,
0x08, 0x08, 0x0e, 0x00, 0xff, 0xef, 0x16, 0x0c, 0x00, 0x00, 0x28, 0x00, 0x28, 0x00, 0x7f, 0x23,
0xff, 0x53, 0x4d, 0x42, 0x25, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x02, 0x0b,
0x0e, 0x20, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x88, 0x13, 0x00,
0x00, 0x00, 0x00, 0x20, 0x00, 0x4c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2d, 0x00, 0x5c,
0x50, 0x49, 0x50, 0x45, 0x5c, 0x4c, 0x41, 0x4e, 0x4d, 0x41, 0x4e, 0x00, 0x68, 0x00, 0x57, 0x72,
0x4c, 0x65, 0x68, 0x44, 0x7a, 0x00, 0x42, 0x31, 0x36, 0x42, 0x42, 0x44, 0x7a, 0x00, 0x01, 0x00,
0x00, 0x10, 0x00, 0x00, 0x00, 0x80, 0x45, 0x53, 0x43, 0x4f, 0x4d, 0x00, 0x00, 0xac, 0x97, 0x6d},//Trama20

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x04, 0xf0, 0xf1,
0x01, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfb, 0x97, 0x6d},//Trama21

{0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x04, 0xf0, 0xf1,
0x01, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x4a, 0x98, 0x6d},//Trama22

{0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x12, 0xf0, 0xf0,
0x0a, 0x0b, 0x0e, 0x00, 0xff, 0xef, 0x14, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x7f, 0x23,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x99, 0x98, 0x6d},//Trama23

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x04, 0xf0, 0xf1,
0x01, 0x0d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x45, 0x99, 0x6d},//Trama24

{0x03, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x04, 0xac, 0x44, 0x4d, 0x02, 0x00, 0x8b, 0xf0, 0xf0,
0x03, 0x2c, 0x00, 0xff, 0xef, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x42, 0x34, 0x20,
0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x1b, 0x49, 0x42, 0x4d,
0x53, 0x45, 0x52, 0x56, 0x45, 0x52, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x00, 0xff, 0x53, 0x4d,
0x42, 0x25, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x00,
0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe8, 0x03, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x06, 0x00, 0x56, 0x00, 0x03, 0x00, 0x01, 0x00, 0x01, 0x00, 0x02, 0x00,
0x17, 0x00, 0x5c, 0x4d, 0x41, 0x49, 0x4c, 0x53, 0x4c, 0x4f, 0x54, 0x5c, 0x42, 0x52, 0x4f, 0x57,
0x53, 0x45, 0x00, 0x09, 0x04, 0x33, 0x17, 0x00, 0x00, 0x00, 0x9b, 0x99, 0x6d, 0x86, 0x99, 0x98},//Trama25

{0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x35, 0xf0, 0xf0,
0x0c, 0x0a, 0x0e, 0x00, 0xff, 0xef, 0x16, 0x04, 0x00, 0x00, 0x00, 0x00, 0x28, 0x00, 0x7f, 0x23,
0xff, 0x53, 0x4d, 0x42, 0x71, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x01, 0x50,
0x00, 0x00, 0x00, 0x45, 0xf1, 0x99, 0x6d, 0x86, 0x45, 0x99, 0x6d, 0x86, 0x1f, 0x09, 0x52, 0x5b},//Trama26

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x35, 0xf0, 0xf0,
0x0a, 0x0e, 0x0e, 0x00, 0xff, 0xef, 0x16, 0x0c, 0x00, 0x00, 0x28, 0x00, 0x28, 0x00, 0x23, 0x7f,
0xff, 0x53, 0x4d, 0x42, 0x71, 0x00, 0x00, 0x00, 0x00, 0x80, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x01, 0x50,
0x00, 0x00, 0x00, 0x00, 0x40, 0x9a, 0x6d, 0x86, 0x9b, 0x99, 0x6d, 0x86, 0x20, 0x09, 0x75, 0x5b},//Trama27

{0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x12, 0xf0, 0xf0,
0x0e, 0x0d, 0x0e, 0x00, 0xff, 0xef, 0x14, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x7f, 0x23,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x8f, 0x9a, 0x6d},//Trama28

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x04, 0xf0, 0xf1,
0x01, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xde, 0x9a, 0x6d},//Trama29

{0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x12, 0xf0, 0xf0,
0x10, 0x0d, 0x0e, 0x00, 0xff, 0xef, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 0x23,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2d, 0x9b, 0x6d},//Trama30

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x04, 0xf0, 0xf1,
0x01, 0x13, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x9b, 0x6d},//Trama31

{0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x03, 0xf0, 0xf0,
0x53, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xcb, 0x9b, 0x6d},//Trama32

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x03, 0xf0, 0xf1,
0x73, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77, 0x9c, 0x6d},//Trama 33

{0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x08, 0x06, 0x00, 0x04,//Trama ARP
0x08, 0x00, 0x06, 0x04, 0x00, 0x01, 0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x94, 0xcc, 0x39, 0xcb,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x94, 0xcc, 0x39, 0xfe},

{0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x08, 0x06, 0x00, 0x01,//Trama ARP
0x08, 0x00, 0x06, 0x04, 0x00, 0x02, 0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x94, 0xcc, 0x39, 0xfe,
0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x94, 0xcc, 0x39, 0xcb, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x08, 0x00, 0x45, 0x00,//Trama IP protocolo TCP
0x00, 0x30, 0x2c, 0x00, 0x40, 0x00, 0x80, 0x06, 0x4b, 0x74, 0xc0, 0xa8, 0x01, 0x02, 0xc0, 0xa8,
0x01, 0x01, 0x04, 0x03, 0x00, 0x15, 0x00, 0x3b, 0xcf, 0x44, 0x00, 0x00, 0x00, 0x00, 0x70, 0x02,
0x20, 0x00, 0x0c, 0x34, 0x00, 0x00, 0x02, 0x04, 0x05, 0xa1, 0x01, 0x01, 0x04, 0x02},

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x08, 0x00, 0x46, 0x00,//Trama IP protocolo TCP
0x00, 0x30, 0x2c, 0x00, 0x40, 0x00, 0x80, 0x06, 0x4b, 0x74, 0xc0, 0xa8, 0x01, 0x02, 0xc0, 0xa8,
0x01, 0x01, 0x04, 0x03, 0x00, 0x15, 0x00, 0x3b, 0xcf, 0x44, 0x00, 0x00, 0x00, 0x00, 0x70, 0x02,
0x20, 0x00, 0x0c, 0x34, 0x00, 0x00, 0x02, 0x04, 0x05, 0xa1, 0x01, 0x01, 0x04, 0x02},

{0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x08, 0x00, 0x46, 0x00,//Trama IP protocolo UDP
0x80, 0x42, 0x04, 0x55, 0x34, 0x11, 0x80, 0x11, 0x3f, 0x45, 0x94, 0xcc, 0x39, 0xcb, 0x94, 0xcc,
0x67, 0x02, 0xaa, 0xbb, 0xcc, 0xdd, 0x04, 0x0c, 0x00, 0x35, 0x00, 0x2e, 0x85, 0x7c, 0xe2, 0x1a,
0x01, 0x00, 0x00, 0x01, 0x00, 0x00, 0x1f, 0xee, 0x8f, 0xf0, 0x03, 0x77, 0x77, 0x77, 0x03, 0x69,
0x73, 0x63, 0x05, 0x65, 0x73, 0x63, 0x6f, 0x6d, 0x03, 0x69, 0x70, 0x6e, 0x02, 0x6d, 0x78, 0x00},

{0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x08, 0x00, 0x46, 0x00,//Trama IP protocolo UDP
0x80, 0x42, 0x04, 0x55, 0x34, 0x11, 0x80, 0x11, 0x3f, 0x45, 0x94, 0xcc, 0x39, 0xcb, 0x94, 0xcc,
0x67, 0x02, 0xaa, 0xbb, 0xcc, 0xdd, 0x04, 0x0c, 0x00, 0x35, 0x00, 0x2e, 0x85, 0x7c, 0xe2, 0x1a,
0x01, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x77, 0x77, 0x77, 0x03, 0x69,
0x63, 0xad, 0x05, 0x65, 0x73, 0x63, 0x6f, 0x6d, 0x03, 0x69, 0x70, 0x6e, 0x02, 0x6d, 0x78, 0x00,
0x00, 0x1c, 0x00, 0x01},

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x08, 0x00, 0x46, 0x00,//Trama IP protocolo ICMP
0x00, 0x30, 0x2c, 0x00, 0x40, 0x00, 0x80, 0x01, 0x46, 0x61, 0xc0, 0xa8, 0x01, 0x02, 0xc0, 0xa8,
0x01, 0x01, 0x04, 0x03, 0x00, 0x15, 0x00, 0x3b, 0xcf, 0x44, 0x00, 0x00, 0x00, 0x00, 0x70, 0x02,
0x20, 0x00, 0x0c, 0x34, 0x00, 0x00, 0x02, 0x04, 0x05, 0xb4, 0x01, 0x01, 0x04, 0x02},

{0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x08, 0x00, 0x45, 0x00,//Trama IP protocolo ICMP
0x00, 0x30, 0x2c, 0x00, 0x40, 0x00, 0x80, 0x01, 0x4b, 0x74, 0xc0, 0xa8, 0x01, 0x02, 0xc0, 0xa8,
0x01, 0x01, 0x03, 0x03, 0x2d, 0x7d, 0x00, 0x3b, 0xcf, 0x44, 0x00, 0x00, 0x00, 0x00, 0x70, 0x02,
0x20, 0x00, 0x0c, 0x34, 0x00, 0x00, 0x02, 0x04, 0x05, 0xb4, 0x01, 0x01, 0x04, 0x02}};

unsigned char E = 0;

int main(void){
	unsigned char opt = 0, repeat = 0;
	do{
		printf("Practica 4 - Alejandro Zepeda Flores\n\n");
		printf("1-. Tramas LLC\n2-. Tramas ARP\n3-. Tramas IP\n");
		printf("4-. Tramas ICMP\n5-. Tramas TCP\n6-. Tramas UDP\n\n");
		printf("Opcion: "); scanf("%d",&opt); 
		switch(opt){
			case 1:
				for(i=0;i<33;i++){
					printf("********************** Trama %d *************************\n", i+1);
					analiza(T[i]);
					printf("********************************************************\n\n");
				}
			break;
			case 2:
				printf("********************** Trama 1 *************************\n");
				analiza(T[33]);
				printf("*********************************************************\n\n");
				printf("********************** Trama 2 *************************\n");
				analiza(T[34]);
				printf("********************************************************\n\n");
			break;
			case 3:
				printf("********************** Trama 1 *************************\n");
				analiza(T[35]);
				printf("*********************************************************\n\n");
				printf("********************** Trama 2 *************************\n");
				analiza(T[36]);
				printf("********************************************************\n\n");
			break;
			case 4:
				printf("********************** Trama 1 *************************\n");
				analiza(T[37]);
				printf("*********************************************************\n\n");
			break;
			case 5:
				printf("********************** Trama 1 *************************\n");
				analiza(T[35]);
				printf("*********************************************************\n\n");
				printf("********************** Trama 2 *************************\n");
				analiza(T[36]);
				printf("********************************************************\n\n");
			break;
			case 6:
				printf("********************** Trama 1 *************************\n");
				analiza(T[37]);
				printf("*********************************************************\n\n");
				printf("********************** Trama 2 *************************\n");
				analiza(T[38]);
				printf("*********************************************************\n\n");
			break;
			default:
				repeat = 1;
				system("cls");
		}
		printf("Desea repetir el programa? SI(1)   NO(2)");
		scanf("%d", &repeat);system("cls");
	}while(repeat == 1);	
	
}

void analiza(unsigned char T[]){

	unsigned char i,j;
	unsigned short int var,var2;
	printf("%c%c%c Cabecera Ethernet %c%c%c\n", 3,3,3,3,3,3);
	printf("MAC destino: %02x:%02x:%02x:%02x:%02x:%02x\n", T[0], T[1], T[2], T[3], T[4], T[5]);
	printf("MAC Origen: %02x:%02x:%02x:%02x:%02x:%02x\n", T[6], T[7], T[8], T[9], T[10], T[11]);
	var=T[12];
	var=var<<8;
	var= var+T[13];
	if(var<=1500){
		printf("Size = %d\n",var);
		printf("%c%c%c Cabecera LLC %c%c%c\n", 3,3,3,3,3,3);
			switch(T[16]&3){
				case 0:
				case 2: //Trama I
					if(E==1){printf("T-I, N(s)=%d, N(r)=%d\n" , T[16]>>1, T[17]>>1);
					if(T[17]&1) printf("%s \n", POF[T[15]&1]);
				}
					/*EXT*/
					else {printf("T-I, N(s)=%d, N(r)=%d\n", (T[16]>>1)&7, T[16]>>5);
					if((T[16]>>4)&1) printf("%s \n", POF[T[15]&1]);
				}
				break;

				case 1: //Trama S
				if(E==0){  printf("T-S,  %s, N(r)= %d\n", supervision[(T[16]>>2)&3], T[16]>>5);
					if((T[16]>>4)&1) printf(" %s \n", POF[T[15]&1]);
				}
					else {printf("T-S,  %s, N(r)= %d\n", supervision[(T[16]>>2)&3], T[17]>>1);
					if(T[17]&1) printf("%s \n", POF[T[15]&1]);
				}
				break;

				case 3:
					if(T[16]&16)
						if(T[15]&1){
							printf("T-U , %s, F\n", UR[((T[16]>>2)&3) + ((T[16]>>3)&28)]);

						}//resp

						else{
							printf("T-U , %s, P\n", UC[((T[16]>>2)&3) + ((T[16]>>3)&28)]);
							if( (((T[16]>>2)&3) + ((T[16]>>3)&28)) == 11 || (((T[16]>>2)&3) +
							 ((T[16]>>3)&28)) == 15 || (((T[16]>>2)&3) + ((T[16]>>3)&28)) == 27)
								E=1;else //if( (((T[16]>>2)&3) + ((T[16]>>3)&28)) == 8 )
								E=0;
						}//comando
							printf("%d\n",E);
				break;
			}
	}else if(var==2048){
		TamIP= (T[14]&15)*4;
		printf("Tipo: IP\n");
		printf("%c%c%c Cabecera IP %c%c%c\n", 3,3,3,3,3,3);
		printf("Version: %d\n", T[14]>>4);
		printf("IHL (Internet Header Lenght): %d bytes\n", (T[14]&15)*4 );
		if( ((T[14]&15)*4) < 20 && ((T[14]&15)*4) > 60 )
		errorP();
		printf("Tipo de servicio: ");
		if(T[15]&16)
			printf("Minimo retardo\n");
		else if(T[15]&8)
			printf("Maximo Troughout\n");
			else if(T[15]&4)
				printf("Maxima confiabilidad\n");
				else if(T[15]&2)
					printf("Minimo costo\n");
					else if(T[15]&1)
						printf("Reservado y puesto a 0\n");
						else printf("Ninguno\n");
		printf("Longitud total: %d bytes\n", (T[16]<<8)|T[17]);
		if( ((T[16]<<8) | T[17])>65535 )
		errorP();
		printf("Identificacion: %d\n", ((T[18]<<8)|T[19]));
		printf("Flags: ");
		if((T[20]&64))
		printf("No fragmentar\n");
		if((T[20]&32))
		printf("Fragmentar mas\n");
		printf("Fragment Offset: %d unidades de 8 bytes\n", (T[20]&31)<<8 | T[21]);
		printf("Time to live: %d saltos\n", T[22]);
		printf("Cheksum de Cabecera: \n");
		checkSUM(T,14,(14 + TamIP -1), 24,0);
		printf("Source Address: %d.%d.%d.%d\n", T[26],T[27],T[28],T[29]);
		printf("Destination Address: %d.%d.%d.%d\n", T[30],T[31],T[32],T[33]);
		if((14 + TamIP - 1) > 33){
			printf("Opciones: \n");
			switch ( (T[34]<<24) | (T[35]<<16) | (T[36]<<8) | (T[37])) {
				case 0:
				printf("End of the Option list\n");
				break;
				case 1:
				printf("No operation (pad)\n");
				break;
				case 7:
				printf("Record route\n");
				break;
				case 68:
				printf("Timestamp\n");
				break;
				case 131:
				printf("Loose source route\n");
				break;
				case 137:
				printf("Strict source route\n");
				break;
				default:
				printf("%08x\n",(T[34]<<24) | (T[35]<<16) | (T[36]<<8) | (T[37]));
				break;
			}
		}
		printf("\nProtocolo: ");
			switch (T[23]) {
				case 1:
				printf("ICMP\n");
				printf("Tipo: %d= ", T[14 + TamIP]);
				switch (T[14 + TamIP]) {
					case 0:
					printf("Respuesta de echo\n");
					break;
					case 3:
					printf("Destino inalcanzable\n");
					printf("Codigo: ");
					switch (T[14 + TamIP + 1]) {
						case 0:
						printf("Error de red inalcanzable\n");
						break;
						case 1:
						printf("Error de host inalcanzable\n");
						break;
						case 2:
						printf("Error de protocolo inalcanzable\n");
						break;
						case 3:
						printf("Error de puerto inalcanzable\n");
						break;
						case 4:
						printf("El datagrama es muy grande, se necesita fragmentacion\n");
						break;
						case 5:
						printf("Error en la ruta de origen\n");
						break;
						case 6:
						printf("Error de red de destino desconocido\n");
						break;
						case 7:
						printf("Error de host destino desconocido\n");
						break;
						case 8:
						printf("Error aislado de host origen\n");
						break;
						case 9:
						printf("La red destino es administrativamente prohibido\n");
						break;
						case 10:
						printf("El host destino es administrativamente prohibido\n");
						break;
						case 11:
						printf("La red es inalcanzable por tipo de servicio\n");
						break;
						case 12:
						printf("El host es inalcanzable por tipo de servicio\n");
						break;
						case 13:
						printf("Comunicacion administrativamente prohibido\n");
						break;
						default:
						printf("Otro\n");
						break;
					}
					break;
					case 4:
					printf("Desactivacion origen\n");
					break;
					case 5:
					printf("Redireccion\n");
					printf("Codigo: ");
					switch (T[14 + TamIP + 1]) {
						case 0:
						printf("Redirecciona datagrama para la red\n");
						break;
						case 1:
						printf("Redirecciona datagrama para el Host\n");
						break;
						case 2:
						printf("Redirecciona datagrama para la TOS y red\n");
						break;
						case 3:
						printf("Redirecciona datagrama para la TOS y Host\n");
						break;
						default:
						printf("Otro\n");
						break;
					}
					break;
					case 8:
					printf("Echo\n");
					break;
					case 9:
					printf("Anuncio de enrutador\n");
					break;
					case 10:
					printf("Seleccion de router\n");
					break;
					case 11:
					printf("Tiempo excedido\n");
					printf("Codigo: ");
					switch (T[14 + TamIP + 1]) {
						case 0:
						printf("Tiempo de vida excedido en transito\n");
						break;
						case 1:
						printf("Fragmento reemsamblado de tiempo excedido\n");
						break;
						default:
						printf("Otro\n");
						break;
					}
					break;
					case 12:
					printf("Problema de parametro\n");
					printf("Codigo: ");
					switch (T[14 + TamIP + 1]) {
						case 0:
						printf("Puntero indica el error\n");
						break;
						case 1:
						printf("Perdida de opcion requerida\n");
						break;
						case 2:
						printf("Mala longitud\n");
						break;
						default:
						printf("Otro\n");
						break;
					}
					break;
					case 13:
					printf("Solicitud de marca de tiempo\n");
					break;
					case 14:
					printf("Respuesta de marca de tiempo\n");
					break;
					case 15:
					printf("Solicitud de informacion\n");
					break;
					case 16:
					printf("Respuesta de informacion\n");
					break;
					case 17:
					printf("Solicitud de mascara de direccion\n");
					break;
					case 18:
					printf("Respuesta de mascara de direccion\n");
					break;
					case 30:
					printf("Seguidor de pista\n");
					break;
					default:
					printf("Otro\n");
					break;
				}
				printf("Checksum: ");
				checkSUM(T,14+TamIP,14+( ((T[16]<<8)|T[17]) -TamIP),14 + TamIP +2,0);
				printf("Otro mensaje de informacion especifica: %d\n", T[14 + TamIP + 4]<<24
			  | T[14 + TamIP + 5]<<16 | T[14 + TamIP + 6]<<8 |T[14 + TamIP + 7]);
				break;
				case 6:
				printf("TCP\n");
				printf("Puerto origen: %d ", T[14 + TamIP]<<8 | T[14 + TamIP + 1]);
				commonPort(T[14 + TamIP]<<8 | T[14 + TamIP + 1]);
				printf("Puerto destino: %d ", T[14 + TamIP + 2]<<8 | T[14 + TamIP + 3]);
				commonPort(T[14 + TamIP + 2]<<8 | T[14 + TamIP + 3]);
				printf("Numero de secuencia: %lu\n", (T[14 + TamIP + 4]<< 24) | (T[14 + TamIP + 5]<<16)
				| (T[14 + TamIP + 6] << 8) | T[14 + TamIP + 7]);
				printf("Numero de reconocimiento: %lu\n", (T[14 + TamIP + 8]<< 24)
				| (T[14 + TamIP + 9]<<16) | (T[14 + TamIP + 10] << 8) | T[14 + TamIP + 11]);
				printf("Offset: %d palabras de 32 bits\n", T[14 + TamIP + 12]>>4);
				if( (T[14 + TamIP + 12]>>4) < 5)
				errorP();
				printf("Flags: ");
				if((T[14 + TamIP + 13]&128))
				printf("El remitente ha reducido la ventana de congestión a la mitad\n");
				if((T[14 + TamIP + 13]&64))
				printf("El receptor recorta la ventana de congestión a la mitad\n");
				if((T[14 + TamIP + 13]&32))
				printf("Consultar puntero urgente, notificar aplicación de servidor de datos urgentes.\n");
				if((T[14 + TamIP + 13]&16))
				printf("Consultar campo de reconocimiento\n");
				if((T[14 + TamIP + 13]&8))
				printf("Datos de insercion\n");
				if((T[14 + TamIP + 13]&4))
				printf("Resetea conexion\n");
				if((T[14 + TamIP + 13]&2))
				printf("Sincronizar numeros de secuencia\n");
				if((T[14 + TamIP + 13]&1))
				printf("No más datos, conexion terminada\n");
				printf("Window: %d\n", T[14 + TamIP + 14]<<8 | T[14 + TamIP + 15]);
				printf("Cheksum:");
				TamTCP=(T[14 + TamIP+12]>>4)*4;
				checkSUM(T,14+TamIP,14+TamIP+TamTCP-1,14+TamIP+16,1);

				printf("Urgent pointer: %d\n", T[14 + TamIP + 18]<<8 | T[14 + TamIP + 19]);

				if((14 + TamIP + TamTCP - 1) > (14 + TamIP + 19)){
					printf("Opciones\n");
					switch ( (T[14 + TamIP + 19 + 1]<<24) | (T[14 + TamIP + 19 + 2]<<16)
					| (T[14 + TamIP + 19 + 3]<<8) | (T[14 + TamIP + 19 + 4])) {
						case 0:
						printf("Fin de la lista de opciones\n");
						break;
						case 1:
						printf("No operacion (pad)\n");
						break;
						case 7:
						printf("Registro de ruta\n");
						break;
						case 68:
						printf("Marca de tiempo\n");
						break;
						case 131:
						printf("Ruta de origen suelto\n");
						break;
						case 137:
						printf("Ruta de fuente estricta\n");
						break;
						default:
						printf("Otro\n");
						break;
					}
				}
				break;
				case 17:
				printf("UDP\n");
				printf("Puerto origen: %d ", T[14 + TamIP]<<8 | T[14 + TamIP + 1]);
				commonPort(T[14 + TamIP]<<8 | T[14 + TamIP + 1]);
				printf("Puerto destino: %d ", T[14 + TamIP + 2]<<8 | T[14 + TamIP + 3]);
				commonPort(T[14 + TamIP + 2]<<8 | T[14 + TamIP + 3]);
				printf("Largo: %d bytes\n", T[14 + TamIP + 4]<<8 | T[14 + TamIP + 5]);
				if( (T[14 + TamIP + 5]) < 8 )
				errorP();
				printf("Cheksum: ");
				checkSUM(T,14+TamIP,14+TamIP+T[14 + TamIP + 4]<<8 | T[14 + TamIP + 5]-1, 14+TamIP+6,1);
				break;
				default:
				printf("Otro\n");
				break;
			}


		}else if(var==2054){
		printf("Tipo: ARP\n");
		printf("%c%c%c Cabecera ARP %c%c%c\n", 3,3,3,3,3,3);
		printf("Tipo de direccion de Hardware: %s\n", TDH[T[15]]);
		printf("Tipo de protocolo: %s \n", TDP[T[16]]);
		printf("Size  de direccion de hardware: %d bytes\n", T[18]);
		printf("Size  de direccion IP: %d bytes\n", T[19]);
		printf("Opcod: %s \n", OPC[T[21]]);
		printf("Direccion de hardware origen: %02x:%02x:%02x:%02x:%02x:%02x\n", T[22],T[23],T[24],T[25],T[26],T[27]);
		printf("Direccion de protocolo origen: %d.%d.%d.%d\n", T[28],T[29],T[30],T[31]);
		printf("Direccion de hardware objetivo: %02x:%02x:%02x:%02x:%02x:%02x\n", T[32],T[33],T[34],T[35],T[36],T[37]);
		printf("Direccion de protocolo objetivo: %d.%d.%d.%d\n", T[38],T[39],T[40],T[41]);
	}else printf("Tipo: Otro");


}

void checkSUM(unsigned char T[], unsigned short int iniT, unsigned short int finT, unsigned short int posXN
	, int chFlag){
	unsigned long int j, tCS=0;
	for(j=iniT;j<finT;j=j+2){
	//	if(j!=posXN)
			tCS=tCS+(T[j]<<8 | T[j+1] );
	}
	tCS=tCS-(T[posXN]<<8 | T[posXN+1]);

	if(chFlag==1){
		tCS=0;
		for(j=iniT;j<finT;j=j+2){
				tCS=tCS+ (T[j]<<8 | T[j+1] );
		}
		tCS= ( (0<<8 | T[23]) + (T[26]<<8 | T[27]) + (T[28]<<8 | T[29]) + (T[30]<<8 | T[31])
		+ (T[32]<<8 | T[33]) + tCS  + (T[16]<<8 | T[17] ));
		tCS= ((tCS&65535) + (tCS>>16) );
		tCS= ~tCS;
		tCS= tCS & 65535;
		printf("%04x \n", tCS);
		if (tCS == 65535) {
			printf("Trama correcta\n");
		} else {
			printf("Trama incorrecta\n");
			errorP();
		}
		return;
	}

	tCS= ((tCS&65535) + (tCS>>16) );
	tCS= ~tCS;
	tCS= tCS & 65535;
	if (tCS == (T[posXN]<<8 | T[posXN+1])) {
		printf("Trama correcta\n");
	} else {
		printf("Trama incorrecta\n");
		errorP();
	}
}

void commonPort(unsigned short int portA){
	switch (portA) {
		case 7:
		printf("Echo\n");
		break;
		case 19:
		printf("chargen\n");
		break;
		case 20:
		printf("ftp-data\n");
		break;
		case 21:
		printf("ftp-control\n");
		break;
		case 22:
		printf("ssh\n");
		break;
		case 23:
		printf("telnet\n");
		break;
		case 25:
		printf("smtp\n");
		break;
		case 37:
		printf("tiempo\n");
		break;
		case 53:
		printf("Dominio\n");
		break;
		case 67:
		printf("bootps\n");
		break;
		case 68:
		printf("bootpc\n");
		break;
		case 69:
		printf("tftp\n");
		break;
		case 79:
		printf("finger\n");
		break;
		case 80:
		printf("http\n");
		break;
		case 110:
		printf("pop3\n");
		break;
		case 111:
		printf("sunrpc\n");
		break;
		case 119:
		printf("nntp\n");
		break;
		case 137:
		printf("netbios-ns\n");
		break;
		case 138:
		printf("netbios-dgm\n");
		break;
		case 143:
		printf("imap\n");
		break;
		case 161:
		printf("snmp\n");
		break;
		case 162:
		printf("snmp-trap\n");
		break;
		case 179:
		printf("bgp\n");
		break;
		case 389:
		printf("ldap\n");
		break;
		case 443:
		printf("https (ss1)\n");
		break;
		case 445:
		printf("microsoft-ds\n");
		break;
		case 500:
		printf("isakmp\n");
		break;
		case 514:
		printf("syslog\n");
		break;
		case 520:
		printf("rip\n");
		break;
		case 1080:
		printf("socks\n");
		break;
		case 33434:
		printf("tracerouts\n");
		break;
		default:
		printf("-\n");
		break;
	}
}

void errorP(){
	printf("Parametros minimos incorrectos\n");
//	exit(0);
}
